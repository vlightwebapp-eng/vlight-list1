<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>機材レンタルリスト</title>
  <base target="_top">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=JetBrains+Mono&display=swap" rel="stylesheet">
  <style>
    :root { --accent: #4ade80; --bg: #0a0a0a; --card-bg: #141414; --border: #2a2a2a; }
    body { background-color: var(--bg); color: #fff; font-family: 'Inter', sans-serif; margin: 0; padding-top: 140px; }
    header { position: fixed; top: 0; width: 100%; height: 70px; background: rgba(10,10,10,0.9); backdrop-filter: blur(10px); border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 40px; box-sizing: border-box; z-index: 1000; }
    .header-title { position: absolute; left: 50%; transform: translateX(-50%); font-size: 20px; font-weight: 700; letter-spacing: 0.05em; color: #fff; pointer-events: none; white-space: nowrap; }
    .logo { height: 40px; }
    #clock { font-family: 'JetBrains Mono', monospace; font-size: 20px; color: var(--accent); }
    .filter-bar { position: fixed; top: 70px; width: 100%; background: var(--bg); padding: 15px 40px; border-bottom: 1px solid var(--border); display: flex; gap: 15px; box-sizing: border-box; z-index: 999; }
    input, select { background: #1a1a1a; border: 1px solid var(--border); color: white; padding: 10px 15px; border-radius: 4px; outline: none; }
    #searchInput { flex-grow: 1; }
    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
    .card { display: flex; background: var(--card-bg); border: 1px solid var(--border); margin-bottom: 30px; border-radius: 8px; overflow: hidden; }
    .image-box { flex: 0 0 320px; background: #000; display: flex; align-items: center; justify-content: center; border-right: 1px solid var(--border); padding: 20px; }
    .image-box img { max-width: 100%; max-height: 280px; object-fit: contain; }
    .info-box { flex: 1; padding: 30px; }
    .mfg-name { font-size: 13px; color: #888; text-transform: uppercase; margin-bottom: 4px; }
    .model-name { font-size: 32px; font-weight: 700; margin: 0 0 10px 0; color: #fff; }
    .cat-tag { display: inline-block; background: #222; color: var(--accent); padding: 3px 10px; border-radius: 3px; font-size: 11px; margin-bottom: 20px; border: 1px solid #333; }
    .spec-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0 40px; }
    .spec-table { width: 100%; border-collapse: collapse; }
    .spec-table td { padding: 8px 0; border-bottom: 1px solid #222; font-size: 14px; vertical-align: top; }
    .label { color: #666; width: 110px; font-size: 12px; }
    .remarks-box { margin-top: 20px; padding: 12px; background: #1a1a1a; border-radius: 4px; font-size: 13px; color: #aaa; border-left: 3px solid var(--accent); }
    @media (max-width: 850px) { .card { flex-direction: column; } .image-box { flex: none; width: 100%; border-right: none; border-bottom: 1px solid var(--border); } .spec-grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>

<header>
  <img src="https://pbs.twimg.com/profile_images/534862530611384320/t4Tf2OL3.png" class="logo">
  <div class="header-title">機材レンタルリスト</div>
  <div id="clock">00:00:00</div>
</header>

<div class="filter-bar">
  <input type="text" id="searchInput" placeholder="機材名、メーカー、備考で検索..." oninput="filterData()">
  <select id="mfgFilter" onchange="filterData()"><option value="">すべてのメーカー</option></select>
  <select id="catFilter" onchange="filterData()"><option value="">すべてのカテゴリー</option></select>
</div>

<div class="container" id="list">データを読み込み中...</div>

<script>
  let masterData = [];
  // GASで「デプロイ」した際の発行URLをここに貼り付けてください
  const gasUrl = "ここにGASのウェブアプリURLを貼り付けてください";

  function updateClock() { document.getElementById('clock').textContent = new Date().toLocaleTimeString('ja-JP', { hour12: false }); }
  setInterval(updateClock, 1000);
  updateClock();

  window.onload = () => {
    if (gasUrl.includes("ここに")) {
      document.getElementById('list').innerHTML = "エラー: GASのURLが設定されていません。";
      return;
    }

    fetch(gasUrl)
      .then(response => response.json())
      .then(data => {
        masterData = data;
        const mfgS = document.getElementById('mfgFilter');
        const catS = document.getElementById('catFilter');
        
        // フィルター項目の生成
        [...new Set(data.map(i => i.manufacturer))].filter(Boolean).sort().forEach(m => {
          mfgS.innerHTML += `<option value="${m}">${m}</option>`;
        });
        [...new Set(data.map(i => i.category))].filter(Boolean).sort().forEach(c => {
          catS.innerHTML += `<option value="${c}">${c}</option>`;
        });
        
        render(data);
      })
      .catch(error => {
        console.error('Fetch error:', error);
        document.getElementById('list').innerHTML = "データの取得に失敗しました。GASの公開設定（全員）を確認してください。";
      });
  };

  function filterData() {
    const k = document.getElementById('searchInput').value.toLowerCase();
    const m = document.getElementById('mfgFilter').value;
    const c = document.getElementById('catFilter').value;
    const filtered = masterData.filter(i => {
      const target = (i.name + i.manufacturer + i.remarks + i.category).toLowerCase();
      return (!k || target.includes(k)) && (!m || i.manufacturer === m) && (!c || i.category === c);
    });
    render(filtered);
  }

  function render(data) {
    const container = document.getElementById('list');
    if (!data || data.length === 0) { container.innerHTML = '<div style="text-align:center; padding:50px; color:#666;">該当する機材が見つかりません</div>'; return; }
    
    container.innerHTML = data.map(item => `
      <div class="card">
        <div class="image-box">
          <img src="${item.imageUrl || 'https://via.placeholder.com/300x200?text=No+Image'}" onerror="this.src='https://via.placeholder.com/300x200?text=Image+Error'">
        </div>
        <div class="info-box">
          <div class="mfg-name">${item.manufacturer || '-'}</div>
          <h2 class="model-name">${item.name || '名称未設定'}</h2>
          <div class="cat-tag">${item.category || '一般'}</div>
          
          <div class="spec-grid">
            <table class="spec-table">
              <tr><td class="label">サイズ・重量</td><td>${item.sizeWeight || '-'}</td></tr>
              <tr><td class="label">コネクタ形状</td><td>${item.connector || '-'}</td></tr>
              <tr><td class="label">定格電圧</td><td>${item.voltage || '-'}</td></tr>
              <tr><td class="label">消費電流</td><td>${item.current || '-'}</td></tr>
              <tr><td class="label">保護等級</td><td>${item.ipRating || '-'}</td></tr>
            </table>
            <table class="spec-table">
              <tr><td class="label">光源</td><td>${item.lightSource || '-'}</td></tr>
              <tr><td class="label">照射角度</td><td>${item.beamAngle || '-'}</td></tr>
              <tr><td class="label">DMX使用ch</td><td>${item.dmx || '-'}</td></tr>
              <tr><td class="label">付属品</td><td>${item.accessories || '-'}</td></tr>
              <tr><td class="label">ケース寸法</td><td>${item.caseSize || '-'}</td></tr>
            </table>
          </div>
          ${item.remarks ? `<div class="remarks-box"><strong>備考:</strong><br>${item.remarks}</div>` : ''}
        </div>
      </div>
    `).join('');
  }
</script>
</body>
</html>
